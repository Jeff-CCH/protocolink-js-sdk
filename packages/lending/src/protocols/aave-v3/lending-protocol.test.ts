import { LendingProtocol } from './lending-protocol';
import * as common from '@protocolink/common';
import { expect } from 'chai';

describe('Test Aave V3 LendingProtocol', function () {
  context('Test getPortfolio', function () {
    const testCases = [
      {
        chainId: common.ChainId.mainnet,
        account: '0xAF06acFD1BD492B913d5807d562e4FC3A6343C4E',
        blockTag: 18797586,
        expected: {
          chainId: 1,
          protocolId: 'aave-v3',
          marketId: 'mainnet',
          utilization: '1',
          healthRate: '0.93258246248607674253',
          netAPY: '-0.18545787298406638452',
          totalSupplyUSD: '58114237.16604937106663955975306072',
          totalBorrowUSD: '50463931.85681213194668127693048362',
          supplies: [
            {
              token: {
                chainId: 1,
                address: '0x7Fc66500c84A76Ad7e9c93437bFc5Ac33E2DDaE9',
                decimals: 18,
                symbol: 'AAVE',
                name: 'Aave Token',
              },
              price: '105.0112',
              balance: '0',
              apy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.66',
              liquidationThreshold: '0.73',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0x6B175474E89094C44Da98b954EedeAC495271d0F',
                decimals: 18,
                symbol: 'DAI',
                name: 'Dai Stablecoin',
              },
              price: '1.00002272',
              balance: '0',
              apy: '0.04054069979413997238',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0x514910771AF9Ca656af840dff83E8264EcF986CA',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.43048',
              balance: '0',
              apy: '0.00011292316266079384',
              usageAsCollateralEnabled: true,
              ltv: '0.53',
              liquidationThreshold: '0.68',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0x5f98805A4E8be255a32880FDeC7F6728C6568bA0',
                decimals: 18,
                symbol: 'LUSD',
                name: 'LUSD Stablecoin',
              },
              price: '0.99907346',
              balance: '0',
              apy: '0.03577655473827457357',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00027726',
              balance: '0',
              apy: '0.04129249914555541349',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0xdAC17F958D2ee523a2206206994597C13D831ec7',
                decimals: 6,
                symbol: 'USDT',
                name: 'Tether USD',
              },
              price: '0.99961',
              balance: '215169.250899',
              apy: '0.04113888262414266182',
              usageAsCollateralEnabled: true,
              ltv: '0.74',
              liquidationThreshold: '0.76',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599',
                decimals: 8,
                symbol: 'WBTC',
                name: 'Wrapped BTC',
              },
              price: '42070.43411843',
              balance: '0',
              apy: '0.00088069472003505139',
              usageAsCollateralEnabled: true,
              ltv: '0.73',
              liquidationThreshold: '0.78',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0xBe9895146f7AF43049ca1c1AE358B0541Ea49704',
                decimals: 18,
                symbol: 'cbETH',
                name: 'Coinbase Wrapped Staked ETH',
              },
              price: '2367.23327843',
              balance: '0',
              apy: '0.00066155636243544685',
              usageAsCollateralEnabled: true,
              ltv: '0.745',
              liquidationThreshold: '0.77',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0xae78736Cd615f374D3085123A210448E74Fc6393',
                decimals: 18,
                symbol: 'rETH',
                name: 'Rocket Pool ETH',
              },
              price: '2450.18252296',
              balance: '0',
              apy: '0.00080602066709354148',
              usageAsCollateralEnabled: true,
              ltv: '0.745',
              liquidationThreshold: '0.77',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2579.31314226',
              balance: '22447.507781248636639372',
              apy: '0.00002953692637359529',
              usageAsCollateralEnabled: true,
              ltv: '0.785',
              liquidationThreshold: '0.81',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2242.39893',
              balance: '0',
              apy: '0.01912664906969010559',
              usageAsCollateralEnabled: true,
              ltv: '0.805',
              liquidationThreshold: '0.83',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0xba100000625a3754423978a60c9317c58a424e3D',
                decimals: 18,
                symbol: 'BAL',
                name: 'Balancer',
              },
              price: '4.00584039',
              balance: '0',
              apy: '0.02641882601000881679',
              usageAsCollateralEnabled: false,
              ltv: '0.57',
              liquidationThreshold: '0.62',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0xD533a949740bb3306d119CC777fa900bA034cd52',
                decimals: 18,
                symbol: 'CRV',
                name: 'Curve DAO Token',
              },
              price: '0.64126945',
              balance: '0',
              apy: '0.00537209814152129923',
              usageAsCollateralEnabled: false,
              ltv: '0.35',
              liquidationThreshold: '0.41',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0xC18360217D8F7Ab5e7c516566761Ea12Ce7F9D72',
                decimals: 18,
                symbol: 'ENS',
                name: 'Ethereum Name Service',
              },
              price: '8.70661924',
              balance: '0',
              apy: '0.00031956336766001557',
              usageAsCollateralEnabled: false,
              ltv: '0.39',
              liquidationThreshold: '0.49',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0x5A98FcBEA516Cf06857215779Fd812CA3beF1B32',
                decimals: 18,
                symbol: 'LDO',
                name: 'Lido DAO Token',
              },
              price: '2.15865322',
              balance: '0',
              apy: '0.00000908766059742753',
              usageAsCollateralEnabled: false,
              ltv: '0.4',
              liquidationThreshold: '0.5',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0x9f8F72aA9304c8B593d555F12eF6589cC3A579A2',
                decimals: 18,
                symbol: 'MKR',
                name: 'Maker',
              },
              price: '1325.12484',
              balance: '0',
              apy: '0.00055163255868484246',
              usageAsCollateralEnabled: false,
              ltv: '0.65',
              liquidationThreshold: '0.7',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0xC011a73ee8576Fb46F5E1c5751cA3B9Fe0af2a6F',
                decimals: 18,
                symbol: 'SNX',
                name: 'Synthetix Network Token',
              },
              price: '4.10424827',
              balance: '0',
              apy: '0.01535264061137685515',
              usageAsCollateralEnabled: false,
              ltv: '0.49',
              liquidationThreshold: '0.65',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984',
                decimals: 18,
                symbol: 'UNI',
                name: 'Uniswap',
              },
              price: '6.1537289',
              balance: '0',
              apy: '0.0001541144618494753',
              usageAsCollateralEnabled: false,
              ltv: '0.65',
              liquidationThreshold: '0.77',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0x111111111117dC0aa78b770fA6A738034120C302',
                decimals: 18,
                symbol: '1INCH',
                name: '1INCH Token',
              },
              price: '0.36715648',
              balance: '0',
              apy: '0.00001417275829874642',
              usageAsCollateralEnabled: false,
              ltv: '0.57',
              liquidationThreshold: '0.67',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0x853d955aCEf822Db058eb8505911ED77F175b99e',
                decimals: 18,
                symbol: 'FRAX',
                name: 'Frax',
              },
              price: '0.99929064',
              balance: '0',
              apy: '0.03601976661346056869',
              usageAsCollateralEnabled: false,
              ltv: '0.7',
              liquidationThreshold: '0.75',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0xD33526068D116cE69F19A9ee46F0bd304F21A51f',
                decimals: 18,
                symbol: 'RPL',
                name: 'Rocket Pool Protocol',
              },
              price: '27.19493893',
              balance: '0',
              apy: '0.01559754249123508373',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1,
                address: '0xAf5191B0De278C7286d6C7CC6ab6BB8A73bA2Cd6',
                decimals: 18,
                symbol: 'STG',
                name: 'StargateToken',
              },
              price: '0.51794661',
              balance: '0',
              apy: '0.00000010978549004967',
              usageAsCollateralEnabled: false,
              ltv: '0.35',
              liquidationThreshold: '0.4',
              isNotCollateral: false,
            },
          ],
          borrows: [
            {
              token: {
                chainId: 1,
                address: '0x6B175474E89094C44Da98b954EedeAC495271d0F',
                decimals: 18,
                symbol: 'DAI',
                name: 'Dai Stablecoin',
              },
              price: '1.00002272',
              balances: ['0', '0'],
              apys: ['0.05077600393079828611', '0.06710875618198908006'],
            },
            {
              token: {
                chainId: 1,
                address: '0x514910771AF9Ca656af840dff83E8264EcF986CA',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.43048',
              balances: ['0', '0'],
              apys: ['0.00469672266338061558', '0.09931331670529735661'],
            },
            {
              token: {
                chainId: 1,
                address: '0x5f98805A4E8be255a32880FDeC7F6728C6568bA0',
                decimals: 18,
                symbol: 'LUSD',
                name: 'LUSD Stablecoin',
              },
              price: '0.99907346',
              balances: ['0', '0'],
              apys: ['0.05064809600568456771', '0.10464693305275143672'],
            },
            {
              token: {
                chainId: 1,
                address: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00027726',
              balances: ['0', '0'],
              apys: ['0.05124690480066431282', '0.06715656857308800284'],
            },
            {
              token: {
                chainId: 1,
                address: '0xdAC17F958D2ee523a2206206994597C13D831ec7',
                decimals: 6,
                symbol: 'USDT',
                name: 'Tether USD',
              },
              price: '0.99961',
              balances: ['0', '0'],
              apys: ['0.05115103904810626772', '0.10506994654348948044'],
            },
            {
              token: {
                chainId: 1,
                address: '0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599',
                decimals: 8,
                symbol: 'WBTC',
                name: 'Wrapped BTC',
              },
              price: '42070.43411843',
              balances: ['0', '0'],
              apys: ['0.00993905766729966149', '0.08037422156178795619'],
            },
            {
              token: {
                chainId: 1,
                address: '0xBe9895146f7AF43049ca1c1AE358B0541Ea49704',
                decimals: 18,
                symbol: 'cbETH',
                name: 'Coinbase Wrapped Staked ETH',
              },
              price: '2367.23327843',
              balances: ['0', '0'],
              apys: ['0.01106206012748106734', '0.10627810524469430904'],
            },
            {
              token: {
                chainId: 1,
                address: '0xae78736Cd615f374D3085123A210448E74Fc6393',
                decimals: 18,
                symbol: 'rETH',
                name: 'Rocket Pool ETH',
              },
              price: '2450.18252296',
              balances: ['0', '0'],
              apys: ['0.01221682491528295028', '0.10754161917542552013'],
            },
            {
              token: {
                chainId: 1,
                address: '0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2579.31314226',
              balances: ['0.000000000199591537', '0'],
              apys: ['0.00350052367445749632', '0.0788373364092462398'],
            },
            {
              token: {
                chainId: 1,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2242.39893',
              balances: ['22504.439857546496928451', '0'],
              apys: ['0.02832454450272690728', '0.10285378922638927006'],
            },
            {
              token: {
                chainId: 1,
                address: '0xba100000625a3754423978a60c9317c58a424e3D',
                decimals: 18,
                symbol: 'BAL',
                name: 'Balancer',
              },
              price: '4.00584039',
              balances: ['0', '0'],
              apys: ['0.13079543144860774213', '0.40905787189305682423'],
            },
            {
              token: {
                chainId: 1,
                address: '0xD533a949740bb3306d119CC777fa900bA034cd52',
                decimals: 18,
                symbol: 'CRV',
                name: 'Curve DAO Token',
              },
              price: '0.64126945',
              balances: ['0', '0'],
              apys: ['0.06001629796737378854', '0.20461793125210363743'],
            },
            {
              token: {
                chainId: 1,
                address: '0xC18360217D8F7Ab5e7c516566761Ea12Ce7F9D72',
                decimals: 18,
                symbol: 'ENS',
                name: 'Ethereum Name Service',
              },
              price: '8.70661924',
              balances: ['0', '0'],
              apys: ['0.00897751203969010139', '0.14214680657301220611'],
            },
            {
              token: {
                chainId: 1,
                address: '0x5A98FcBEA516Cf06857215779Fd812CA3beF1B32',
                decimals: 18,
                symbol: 'LDO',
                name: 'Lido DAO Token',
              },
              price: '2.15865322',
              balances: ['0', '0'],
              apys: ['0.00133018338243446772', '0.10790262274477364801'],
            },
            {
              token: {
                chainId: 1,
                address: '0x9f8F72aA9304c8B593d555F12eF6589cC3A579A2',
                decimals: 18,
                symbol: 'MKR',
                name: 'Maker',
              },
              price: '1325.12484',
              balances: ['0', '0'],
              apys: ['0.0104091053083956077', '0.12663045287848001661'],
            },
            {
              token: {
                chainId: 1,
                address: '0xC011a73ee8576Fb46F5E1c5751cA3B9Fe0af2a6F',
                decimals: 18,
                symbol: 'SNX',
                name: 'Synthetix Network Token',
              },
              price: '4.10424827',
              balances: ['0', '0'],
              apys: ['0.08650980183324964408', '0.26234429188128784448'],
            },
            {
              token: {
                chainId: 1,
                address: '0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984',
                decimals: 18,
                symbol: 'UNI',
                name: 'Uniswap',
              },
              price: '6.1537289',
              balances: ['0', '0'],
              apys: ['0.00548898362962160323', '0.11646333399830974161'],
            },
            {
              token: {
                chainId: 1,
                address: '0x40D16FC0246aD3160Ccc09B8D0D3A2cD28aE6C2f',
                decimals: 18,
                symbol: 'GHO',
                name: 'Gho Token',
              },
              price: '1',
              balances: ['0', '0'],
              apys: ['0.05358643868526975825', '0'],
            },
            {
              token: {
                chainId: 1,
                address: '0x111111111117dC0aa78b770fA6A738034120C302',
                decimals: 18,
                symbol: '1INCH',
                name: '1INCH Token',
              },
              price: '0.36715648',
              balances: ['0', '0'],
              apys: ['0.00188410222613479303', '0.13056659684532829206'],
            },
            {
              token: {
                chainId: 1,
                address: '0x853d955aCEf822Db058eb8505911ED77F175b99e',
                decimals: 18,
                symbol: 'FRAX',
                name: 'Frax',
              },
              price: '0.99929064',
              balances: ['0', '0'],
              apys: ['0.0478462503067623037', '0.06681085298796353616'],
            },
            {
              token: {
                chainId: 1,
                address: '0xD33526068D116cE69F19A9ee46F0bd304F21A51f',
                decimals: 18,
                symbol: 'RPL',
                name: 'Rocket Pool Protocol',
              },
              price: '27.19493893',
              balances: ['0', '0'],
              apys: ['0.04638176421561664829', '0.15066297254037223458'],
            },
          ],
        },
      },
      {
        chainId: common.ChainId.polygon,
        account: '0x1DC6074361a3cddEe55A61C92BCf7dE1667e1096',
        blockTag: 51191189,
        expected: {
          chainId: 137,
          protocolId: 'aave-v3',
          marketId: 'polygon',
          utilization: '1',
          healthRate: '0.90612560491813814332',
          netAPY: '-0.10680233136150586388',
          totalSupplyUSD: '5010944.21212936040137530713982855',
          totalBorrowUSD: '4406117.40708319030498718975500212',
          supplies: [
            {
              token: {
                chainId: 137,
                address: '0x9a71012B13CA4d3D0Cdc72A177DF3ef03b0E76A3',
                decimals: 18,
                symbol: 'BAL',
                name: 'Balancer (PoS)',
              },
              price: '3.9956512',
              balance: '0',
              apy: '0.02398430071252111754',
              usageAsCollateralEnabled: true,
              ltv: '0.2',
              liquidationThreshold: '0.45',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0x172370d5Cd63279eFa6d502DAB29171933a610AF',
                decimals: 18,
                symbol: 'CRV',
                name: 'CRV (PoS)',
              },
              price: '0.6443846',
              balance: '0',
              apy: '0.00268539813425108943',
              usageAsCollateralEnabled: true,
              ltv: '0.35',
              liquidationThreshold: '0.5',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063',
                decimals: 18,
                symbol: 'DAI',
                name: '(PoS) Dai Stablecoin',
              },
              price: '1.00004519',
              balance: '0',
              apy: '0.102404560925092111',
              usageAsCollateralEnabled: true,
              ltv: '0.76',
              liquidationThreshold: '0.81',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0x85955046DF4668e1DD369D2DE9f3AEB98DD2A369',
                decimals: 18,
                symbol: 'DPI',
                name: 'DefiPulse Index (PoS)',
              },
              price: '90.38696341',
              balance: '0',
              apy: '0.00226570275621370561',
              usageAsCollateralEnabled: true,
              ltv: '0.2',
              liquidationThreshold: '0.45',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0xE111178A87A3BFf0c8d18DECBa5798827539Ae99',
                decimals: 2,
                symbol: 'EURS',
                name: 'STASIS EURS Token (PoS)',
              },
              price: '1.08955',
              balance: '0',
              apy: '0.04236501913711933105',
              usageAsCollateralEnabled: false,
              ltv: '0.65',
              liquidationThreshold: '0.7',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0x385Eeac5cB85A38A9a07A70c73e0a3271CfB54A7',
                decimals: 18,
                symbol: 'GHST',
                name: 'Aavegotchi GHST Token (PoS)',
              },
              price: '0.88730933',
              balance: '0',
              apy: '0.0000128307733131702',
              usageAsCollateralEnabled: true,
              ltv: '0',
              liquidationThreshold: '0.45',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0x53E0bca35eC356BD5ddDFebbD1Fc0fD03FaBad39',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.520532',
              balance: '0',
              apy: '0.00066061291348093353',
              usageAsCollateralEnabled: true,
              ltv: '0.53',
              liquidationThreshold: '0.68',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0x0b3F868E0BE5597D5DB7fEB59E1CADBb0fdDa50a',
                decimals: 18,
                symbol: 'SUSHI',
                name: 'SushiToken (PoS)',
              },
              price: '1.18695',
              balance: '0',
              apy: '0.01379983275166733885',
              usageAsCollateralEnabled: true,
              ltv: '0.2',
              liquidationThreshold: '0.45',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin (PoS)',
              },
              price: '1.00019144',
              balance: '564056.5712',
              apy: '0.04109577157304434953',
              usageAsCollateralEnabled: true,
              ltv: '0.825',
              liquidationThreshold: '0.85',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0xc2132D05D31c914a87C6611C10748AEb04B58e8F',
                decimals: 6,
                symbol: 'USDT',
                name: '(PoS) Tether USD',
              },
              price: '0.99943231',
              balance: '0',
              apy: '0.04108599306239929215',
              usageAsCollateralEnabled: false,
              ltv: '0.75',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0x1BFD67037B42Cf73acF2047067bd4F2C47D9BfD6',
                decimals: 8,
                symbol: 'WBTC',
                name: '(PoS) Wrapped BTC',
              },
              price: '42219.05',
              balance: '0',
              apy: '0.00031298671785929897',
              usageAsCollateralEnabled: true,
              ltv: '0.73',
              liquidationThreshold: '0.78',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619',
                decimals: 18,
                symbol: 'WETH',
                name: 'Wrapped Ether',
              },
              price: '2247.22899356',
              balance: '0',
              apy: '0.00416696157636002867',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.825',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0xE0B52e49357Fd4DAf2c15e02058DCE6BC0057db4',
                decimals: 18,
                symbol: 'agEUR',
                name: 'agEUR',
              },
              price: '1.08955',
              balance: '0',
              apy: '0.02383700817004330826',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0xD6DF932A45C0f255f85145f286eA0b292B21C90B',
                decimals: 18,
                symbol: 'AAVE',
                name: 'Aave (PoS)',
              },
              price: '105.77',
              balance: '0',
              apy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.6',
              liquidationThreshold: '0.7',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0xfa68FB4628DFF1028CFEc22b4162FCcd0d45efb6',
                decimals: 18,
                symbol: 'MaticX',
                name: 'Liquid Staking Matic (PoS)',
              },
              price: '0.92878185',
              balance: '0',
              apy: '0.00001047255641318724',
              usageAsCollateralEnabled: true,
              ltv: '0.45',
              liquidationThreshold: '0.58',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0x3A58a54C066FdC0f2D55FC9C89F0415C92eBf3C4',
                decimals: 18,
                symbol: 'stMATIC',
                name: 'Staked MATIC (PoS)',
              },
              price: '0.93449977',
              balance: '0',
              apy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.45',
              liquidationThreshold: '0.56',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0x0000000000000000000000000000000000001010',
                decimals: 18,
                symbol: 'MATIC',
                name: 'Matic Token',
              },
              price: '0.8509',
              balance: '0',
              apy: '0.00716950236803243848',
              usageAsCollateralEnabled: true,
              ltv: '0.68',
              liquidationThreshold: '0.73',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 137,
                address: '0x03b54A6e9a984069379fae1a4fC4dBAE93B3bCCD',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0 (PoS)',
              },
              price: '2584.86890945',
              balance: '1720.311479503825664839',
              apy: '0.0003366412907512745',
              usageAsCollateralEnabled: true,
              ltv: '0.7',
              liquidationThreshold: '0.79',
              isNotCollateral: false,
            },
          ],
          borrows: [
            {
              token: {
                chainId: 137,
                address: '0x9a71012B13CA4d3D0Cdc72A177DF3ef03b0E76A3',
                decimals: 18,
                symbol: 'BAL',
                name: 'Balancer (PoS)',
              },
              price: '3.9956512',
              balances: ['0', '0'],
              apys: ['0.12598755980095025475', '0.4030668949606997306'],
            },
            {
              token: {
                chainId: 137,
                address: '0x172370d5Cd63279eFa6d502DAB29171933a610AF',
                decimals: 18,
                symbol: 'CRV',
                name: 'CRV (PoS)',
              },
              price: '0.6443846',
              balances: ['0', '0'],
              apys: ['0.04853267693489157765', '0.19714329899548234933'],
            },
            {
              token: {
                chainId: 137,
                address: '0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063',
                decimals: 18,
                symbol: 'DAI',
                name: '(PoS) Dai Stablecoin',
              },
              price: '1.00004519',
              balances: ['0', '0'],
              apys: ['0.12860019871044775823', '0.14565680636886070874'],
            },
            {
              token: {
                chainId: 137,
                address: '0x85955046DF4668e1DD369D2DE9f3AEB98DD2A369',
                decimals: 18,
                symbol: 'DPI',
                name: 'DefiPulse Index (PoS)',
              },
              price: '90.38696341',
              balances: ['0', '0'],
              apys: ['0.02820635122551321891', '0.12749685132195629963'],
            },
            {
              token: {
                chainId: 137,
                address: '0xE111178A87A3BFf0c8d18DECBa5798827539Ae99',
                decimals: 2,
                symbol: 'EURS',
                name: 'STASIS EURS Token (PoS)',
              },
              price: '1.08955',
              balances: ['0', '0'],
              apys: ['0.0592561702948847833', '0.07766562615736471898'],
            },
            {
              token: {
                chainId: 137,
                address: '0x385Eeac5cB85A38A9a07A70c73e0a3271CfB54A7',
                decimals: 18,
                symbol: 'GHST',
                name: 'Aavegotchi GHST Token (PoS)',
              },
              price: '0.88730933',
              balances: ['0', '0'],
              apys: ['0.00175384687307236684', '0.09417428356469140047'],
            },
            {
              token: {
                chainId: 137,
                address: '0x53E0bca35eC356BD5ddDFebbD1Fc0fD03FaBad39',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.520532',
              balances: ['0', '0'],
              apys: ['0.0113962663343863007', '0.09417428356469140047'],
            },
            {
              token: {
                chainId: 137,
                address: '0x0b3F868E0BE5597D5DB7fEB59E1CADBb0fdDa50a',
                decimals: 18,
                symbol: 'SUSHI',
                name: 'SushiToken (PoS)',
              },
              price: '1.18695',
              balances: ['0', '0'],
              apys: ['0.05297890599302992645', '0.09417428356469140047'],
            },
            {
              token: {
                chainId: 137,
                address: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin (PoS)',
              },
              price: '1.00019144',
              balances: ['0', '0'],
              apys: ['0.05107156825828361061', '0.06713876822693449513'],
            },
            {
              token: {
                chainId: 137,
                address: '0xc2132D05D31c914a87C6611C10748AEb04B58e8F',
                decimals: 6,
                symbol: 'USDT',
                name: '(PoS) Tether USD',
              },
              price: '0.99943231',
              balances: ['0', '0'],
              apys: ['0.05075011837520909759', '0.06710612736203787438'],
            },
            {
              token: {
                chainId: 137,
                address: '0x1BFD67037B42Cf73acF2047067bd4F2C47D9BfD6',
                decimals: 8,
                symbol: 'WBTC',
                name: '(PoS) Wrapped BTC',
              },
              price: '42219.05',
              balances: ['0', '0'],
              apys: ['0.00591410184324957224', '0.06183654648475251348'],
            },
            {
              token: {
                chainId: 137,
                address: '0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619',
                decimals: 18,
                symbol: 'WETH',
                name: 'Wrapped Ether',
              },
              price: '2247.22899356',
              balances: ['1960.689106321620159627', '0'],
              apys: ['0.02026243331547969329', '0.07809306076386978154'],
            },
            {
              token: {
                chainId: 137,
                address: '0xE0B52e49357Fd4DAf2c15e02058DCE6BC0057db4',
                decimals: 18,
                symbol: 'agEUR',
                name: 'agEUR',
              },
              price: '1.08955',
              balances: ['0', '0'],
              apys: ['0.03911667701482021137', '0.05632549887408808505'],
            },
            {
              token: {
                chainId: 137,
                address: '0xfa68FB4628DFF1028CFEc22b4162FCcd0d45efb6',
                decimals: 18,
                symbol: 'MaticX',
                name: 'Liquid Staking Matic (PoS)',
              },
              price: '0.92878185',
              balances: ['0', '0'],
              apys: ['0.00290530621187056917', '0.06188978484826666567'],
            },
            {
              token: {
                chainId: 137,
                address: '0x0000000000000000000000000000000000001010',
                decimals: 18,
                symbol: 'MATIC',
                name: 'Matic Token',
              },
              price: '0.8509',
              balances: ['0', '0'],
              apys: ['0.024699422445879656', '0.07250818117089440143'],
            },
            {
              token: {
                chainId: 137,
                address: '0x03b54A6e9a984069379fae1a4fC4dBAE93B3bCCD',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0 (PoS)',
              },
              price: '2584.86890945',
              balances: ['0', '0'],
              apys: ['0.00769511636504645238', '0.06201246487118937443'],
            },
          ],
        },
      },
      {
        chainId: common.ChainId.arbitrum,
        account: '0xccFa0530B9d52f970d1A2dAEa670ce58E4176389',
        blockTag: 160658642,
        expected: {
          chainId: 42161,
          protocolId: 'aave-v3',
          marketId: 'arbitrum',
          utilization: '1',
          healthRate: '0.91283015658571094827',
          netAPY: '-0.18305654826864585187',
          totalSupplyUSD: '9567824.24670337643165871963088905',
          totalBorrowUSD: '8280380.6385705752091152379413338',
          supplies: [
            {
              token: {
                chainId: 42161,
                address: '0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1',
                decimals: 18,
                symbol: 'DAI',
                name: 'Dai Stablecoin',
              },
              price: '1.00005605',
              balance: '0',
              apy: '0.04524455173985258882',
              usageAsCollateralEnabled: true,
              ltv: '0.77',
              liquidationThreshold: '0.82',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0xD22a58f79e9481D1a88e00c343885A588b34b68B',
                decimals: 2,
                symbol: 'EURS',
                name: 'STASIS EURS Token',
              },
              price: '1.08955',
              balance: '0',
              apy: '0.02216750558908961218',
              usageAsCollateralEnabled: false,
              ltv: '0.65',
              liquidationThreshold: '0.7',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0xf97f4df75117a78c1A5a0DBb814Af92458539FB4',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.48570799',
              balance: '0',
              apy: '0.00110844637730505253',
              usageAsCollateralEnabled: true,
              ltv: '0.7',
              liquidationThreshold: '0.775',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9',
                decimals: 6,
                symbol: 'USDT',
                name: 'Tether USD',
              },
              price: '0.99993522',
              balance: '0',
              apy: '0.06013539446848360279',
              usageAsCollateralEnabled: false,
              ltv: '0.75',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0x2f2a2543B76A4166549F7aaB2e75Bef0aefC5B0f',
                decimals: 8,
                symbol: 'WBTC',
                name: 'Wrapped BTC',
              },
              price: '42331.442229',
              balance: '0',
              apy: '0.00116524608978289489',
              usageAsCollateralEnabled: true,
              ltv: '0.73',
              liquidationThreshold: '0.78',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8',
                decimals: 6,
                symbol: 'USDC.e',
                name: 'USD Coin (Arb1)',
              },
              price: '1.00023692',
              balance: '0',
              apy: '0.06185280657302697309',
              usageAsCollateralEnabled: true,
              ltv: '0.81',
              liquidationThreshold: '0.86',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0xba5DdD1f9d7F570dc94a51479a000E3BCE967196',
                decimals: 18,
                symbol: 'AAVE',
                name: 'Aave Token',
              },
              price: '106.7851',
              balance: '0',
              apy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.5',
              liquidationThreshold: '0.65',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2244.01978972',
              balance: '0',
              apy: '0.0163833672945417932',
              usageAsCollateralEnabled: true,
              ltv: '0.825',
              liquidationThreshold: '0.85',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0x93b346b6BC2548dA6A1E7d98E9a421B42541425b',
                decimals: 18,
                symbol: 'LUSD',
                name: 'LUSD Stablecoin',
              },
              price: '0.99912831',
              balance: '0',
              apy: '0.03498368035229415632',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0xaf88d065e77c8cC2239327C5EDb3A432268e5831',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00023692',
              balance: '0',
              apy: '0.04104600900636756498',
              usageAsCollateralEnabled: true,
              ltv: '0.81',
              liquidationThreshold: '0.86',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0xEC70Dcb4A1EFa46b8F2D97C310C9c4790ba5ffA8',
                decimals: 18,
                symbol: 'rETH',
                name: 'Rocket Pool ETH',
              },
              price: '2451.95357364',
              balance: '0',
              apy: '0.00431178472420963324',
              usageAsCollateralEnabled: true,
              ltv: '0.67',
              liquidationThreshold: '0.74',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0x5979D7b546E38E414F7E9822514be443A4800529',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2581.17753165',
              balance: '3706.767213562102614957',
              apy: '0.00001625302636224031',
              usageAsCollateralEnabled: true,
              ltv: '0.7',
              liquidationThreshold: '0.79',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0x912CE59144191C1204E64559FE8253a0e49E6548',
                decimals: 18,
                symbol: 'ARB',
                name: 'Arbitrum',
              },
              price: '1.12526332',
              balance: '0',
              apy: '0.00308609822196671461',
              usageAsCollateralEnabled: false,
              ltv: '0.5',
              liquidationThreshold: '0.6',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 42161,
                address: '0x17FC002b466eEc40DaE837Fc4bE5c67993ddBd6F',
                decimals: 18,
                symbol: 'FRAX',
                name: 'Frax',
              },
              price: '0.99916755',
              balance: '0',
              apy: '0.03945025997042045639',
              usageAsCollateralEnabled: false,
              ltv: '0.7',
              liquidationThreshold: '0.75',
              isNotCollateral: false,
            },
          ],
          borrows: [
            {
              token: {
                chainId: 42161,
                address: '0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1',
                decimals: 18,
                symbol: 'DAI',
                name: 'Dai Stablecoin',
              },
              price: '1.00005605',
              balances: ['0', '0'],
              apys: ['0.05127426226771750666', '0.06716223809302373125'],
            },
            {
              token: {
                chainId: 42161,
                address: '0xD22a58f79e9481D1a88e00c343885A588b34b68B',
                decimals: 2,
                symbol: 'EURS',
                name: 'STASIS EURS Token',
              },
              price: '1.08955',
              balances: ['0', '0'],
              apys: ['0.04137370221553932538', '0.08544661217971374907'],
            },
            {
              token: {
                chainId: 42161,
                address: '0xf97f4df75117a78c1A5a0DBb814Af92458539FB4',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.48570799',
              balances: ['0', '0'],
              apys: ['0.0147851512314853723', '0.09417428356469140047'],
            },
            {
              token: {
                chainId: 42161,
                address: '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9',
                decimals: 6,
                symbol: 'USDT',
                name: 'Tether USD',
              },
              price: '0.99993522',
              balances: ['0', '0'],
              apys: ['0.07907546292614059152', '0.09762264086619622398'],
            },
            {
              token: {
                chainId: 42161,
                address: '0x2f2a2543B76A4166549F7aaB2e75Bef0aefC5B0f',
                decimals: 8,
                symbol: 'WBTC',
                name: 'Wrapped BTC',
              },
              price: '42331.442229',
              balances: ['0', '0'],
              apys: ['0.01144019864042859424', '0.06183654648475251348'],
            },
            {
              token: {
                chainId: 42161,
                address: '0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8',
                decimals: 6,
                symbol: 'USDC.e',
                name: 'USD Coin (Arb1)',
              },
              price: '1.00023692',
              balances: ['0', '0'],
              apys: ['0.08567990769323201746', '0.11129654612923720547'],
            },
            {
              token: {
                chainId: 42161,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2244.01978972',
              balances: ['3689.976655510586505415', '0'],
              apys: ['0.02848063384870475934', '0.10190391507850445994'],
            },
            {
              token: {
                chainId: 42161,
                address: '0x93b346b6BC2548dA6A1E7d98E9a421B42541425b',
                decimals: 18,
                symbol: 'LUSD',
                name: 'LUSD Stablecoin',
              },
              price: '0.99912831',
              balances: ['0', '0'],
              apys: ['0.05007970601435907876', '0.10416882493142522471'],
            },
            {
              token: {
                chainId: 42161,
                address: '0xaf88d065e77c8cC2239327C5EDb3A432268e5831',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00023692',
              balances: ['0', '0'],
              apys: ['0.05109299271756908264', '0.11608895331573361409'],
            },
            {
              token: {
                chainId: 42161,
                address: '0xEC70Dcb4A1EFa46b8F2D97C310C9c4790ba5ffA8',
                decimals: 18,
                symbol: 'rETH',
                name: 'Rocket Pool ETH',
              },
              price: '2451.95357364',
              balances: ['0', '0'],
              apys: ['0.02845784592439778344', '0.16429092248919515124'],
            },
            {
              token: {
                chainId: 42161,
                address: '0x5979D7b546E38E414F7E9822514be443A4800529',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2581.17753165',
              balances: ['0', '0'],
              apys: ['0.00311888292011425678', '0.05654061462482147768'],
            },
            {
              token: {
                chainId: 42161,
                address: '0x912CE59144191C1204E64559FE8253a0e49E6548',
                decimals: 18,
                symbol: 'ARB',
                name: 'Arbitrum',
              },
              price: '1.12526332',
              balances: ['0', '0'],
              apys: ['0.02477958780886026724', '0.11013047450903380581'],
            },
            {
              token: {
                chainId: 42161,
                address: '0x17FC002b466eEc40DaE837Fc4bE5c67993ddBd6F',
                decimals: 18,
                symbol: 'FRAX',
                name: 'Frax',
              },
              price: '0.99916755',
              balances: ['0', '0'],
              apys: ['0.05008508530654595292', '0.06703856961926286115'],
            },
          ],
        },
      },
      {
        chainId: common.ChainId.optimism,
        account: '0x7b9CDCC6831796fCcB21b5f7241e2cEd813Efe92',
        blockTag: 113571686,
        expected: {
          chainId: 10,
          protocolId: 'aave-v3',
          marketId: 'optimism',
          utilization: '1',
          healthRate: '0.92207500097807484087',
          netAPY: '-0.19301423613982885787',
          totalSupplyUSD: '7129880.78864845658706943890608614',
          totalBorrowUSD: '6185944.3373569923772633536008896',
          supplies: [
            {
              token: {
                chainId: 10,
                address: '0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1',
                decimals: 18,
                symbol: 'DAI',
                name: 'Dai Stablecoin',
              },
              price: '1.00002282',
              balance: '0',
              apy: '0.08029571572141981405',
              usageAsCollateralEnabled: true,
              ltv: '0.78',
              liquidationThreshold: '0.83',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 10,
                address: '0x350a791Bfc2C21F9Ed5d10980Dad2e2638ffa7f6',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.64277',
              balance: '0',
              apy: '0.00031629974871617226',
              usageAsCollateralEnabled: true,
              ltv: '0.7',
              liquidationThreshold: '0.75',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 10,
                address: '0x8c6f28f2F1A3C87F0f938b96d27520d9751ec8d9',
                decimals: 18,
                symbol: 'sUSD',
                name: 'Synth sUSD',
              },
              price: '0.99889539',
              balance: '0',
              apy: '0.02912717500053536556',
              usageAsCollateralEnabled: true,
              ltv: '0.6',
              liquidationThreshold: '0.75',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 10,
                address: '0x7F5c764cBc14f9669B88837ca1490cCa17c31607',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00000221',
              balance: '0',
              apy: '0.05478173148480717051',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.85',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 10,
                address: '0x68f180fcCe6836688e9084f035309E29Bf0A2095',
                decimals: 8,
                symbol: 'WBTC',
                name: 'Wrapped BTC',
              },
              price: '42472.674242',
              balance: '0',
              apy: '0.0004181808344552407',
              usageAsCollateralEnabled: true,
              ltv: '0.73',
              liquidationThreshold: '0.78',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 10,
                address: '0x94b008aA00579c1307B0EF2c499aD98a8ce58e58',
                decimals: 6,
                symbol: 'USDT',
                name: 'Tether USD',
              },
              price: '0.99976223',
              balance: '0',
              apy: '0.1155507491940290518',
              usageAsCollateralEnabled: false,
              ltv: '0.75',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 10,
                address: '0x76FB31fb4af56892A25e32cFC43De717950c9278',
                decimals: 18,
                symbol: 'AAVE',
                name: 'Aave Token',
              },
              price: '107.3828',
              balance: '0',
              apy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.5',
              liquidationThreshold: '0.65',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 10,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2253.0864232',
              balance: '0',
              apy: '0.01759972129931819265',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.825',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 10,
                address: '0x1F32b1c2345538c0c6f582fCB022739c4A194Ebb',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2591.60640163',
              balance: '2751.143377390985329378',
              apy: '0.00006280656369123281',
              usageAsCollateralEnabled: true,
              ltv: '0.71',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 10,
                address: '0x4200000000000000000000000000000000000042',
                decimals: 18,
                symbol: 'OP',
                name: 'Optimism',
              },
              price: '2.18156955',
              balance: '0',
              apy: '0.00033439753394630285',
              usageAsCollateralEnabled: true,
              ltv: '0.3',
              liquidationThreshold: '0.4',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 10,
                address: '0x9Bcef72be871e61ED4fBbc7630889beE758eb81D',
                decimals: 18,
                symbol: 'rETH',
                name: 'Rocket Pool ETH',
              },
              price: '2461.68955583',
              balance: '0',
              apy: '0.00006157040312459567',
              usageAsCollateralEnabled: true,
              ltv: '0.67',
              liquidationThreshold: '0.74',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 10,
                address: '0xc40F949F8a4e094D1b49a23ea9241D289B7b2819',
                decimals: 18,
                symbol: 'LUSD',
                name: 'LUSD Stablecoin',
              },
              price: '0.99939599',
              balance: '0',
              apy: '0.10086907307902019713',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0',
              isNotCollateral: false,
            },
          ],
          borrows: [
            {
              token: {
                chainId: 10,
                address: '0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1',
                decimals: 18,
                symbol: 'DAI',
                name: 'Dai Stablecoin',
              },
              price: '1.00002282',
              balances: ['0', '0'],
              apys: ['0.10214629003321339804', '0.1188030980747120159'],
            },
            {
              token: {
                chainId: 10,
                address: '0x350a791Bfc2C21F9Ed5d10980Dad2e2638ffa7f6',
                decimals: 18,
                symbol: 'LINK',
                name: 'ChainLink Token',
              },
              price: '14.64277',
              balances: ['0', '0'],
              apys: ['0.00787257455741770749', '0.09417428356469140047'],
            },
            {
              token: {
                chainId: 10,
                address: '0x8c6f28f2F1A3C87F0f938b96d27520d9751ec8d9',
                decimals: 18,
                symbol: 'sUSD',
                name: 'Synth sUSD',
              },
              price: '0.99889539',
              balances: ['0', '0'],
              apys: ['0.04566415286176893977', '0.06658848548003054493'],
            },
            {
              token: {
                chainId: 10,
                address: '0x7F5c764cBc14f9669B88837ca1490cCa17c31607',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.00000221',
              balances: ['0', '0'],
              apys: ['0.078596936193978136', '0.09489784134168523575'],
            },
            {
              token: {
                chainId: 10,
                address: '0x68f180fcCe6836688e9084f035309E29Bf0A2095',
                decimals: 8,
                symbol: 'WBTC',
                name: 'Wrapped BTC',
              },
              price: '42472.674242',
              balances: ['0', '0'],
              apys: ['0.00683905789364176548', '0.06183654648475251348'],
            },
            {
              token: {
                chainId: 10,
                address: '0x94b008aA00579c1307B0EF2c499aD98a8ce58e58',
                decimals: 6,
                symbol: 'USDT',
                name: 'Tether USD',
              },
              price: '0.99976223',
              balances: ['0', '0'],
              apys: ['0.14946330461076310507', '0.16683521772527190746'],
            },
            {
              token: {
                chainId: 10,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'ETH',
                name: 'Ethereum',
              },
              price: '2253.0864232',
              balances: ['2745.542414023895564728', '0'],
              apys: ['0.02952515678478624892', '0.10326053566797938295'],
            },
            {
              token: {
                chainId: 10,
                address: '0x1F32b1c2345538c0c6f582fCB022739c4A194Ebb',
                decimals: 18,
                symbol: 'wstETH',
                name: 'Wrapped liquid staked Ether 2.0',
              },
              price: '2591.60640163',
              balances: ['0', '0'],
              apys: ['0.00425087768018463859', '0.05838257290304102122'],
            },
            {
              token: {
                chainId: 10,
                address: '0x9Bcef72be871e61ED4fBbc7630889beE758eb81D',
                decimals: 18,
                symbol: 'rETH',
                name: 'Rocket Pool ETH',
              },
              price: '2461.68955583',
              balances: ['0', '0'],
              apys: ['0.00336234068910269273', '0.11208193145116272024'],
            },
            {
              token: {
                chainId: 10,
                address: '0xc40F949F8a4e094D1b49a23ea9241D289B7b2819',
                decimals: 18,
                symbol: 'LUSD',
                name: 'LUSD Stablecoin',
              },
              price: '0.99939599',
              balances: ['0', '0'],
              apys: ['0.13934785921335083626', '0.197763472813677731'],
            },
          ],
        },
      },
      {
        chainId: common.ChainId.avalanche,
        account: '0xf567361ff0bCDcAd1252c8E2Fb8e5d4a9bB4e266',
        blockTag: 39128043,
        expected: {
          chainId: 43114,
          protocolId: 'aave-v3',
          marketId: 'avalanche',
          utilization: '0.75992353673586861559',
          healthRate: '1.40587165388572483349',
          netAPY: '0.00470661909745758133',
          totalSupplyUSD: '2096544.2124297834856',
          totalBorrowUSD: '1135610.1168707633355002636817958',
          supplies: [
            {
              token: {
                chainId: 43114,
                address: '0xD24C2Ad096400B6FBcd2ad8B24E7acBc21A1da64',
                decimals: 18,
                symbol: 'FRAX',
                name: 'Frax',
              },
              price: '0.99923705',
              balance: '0',
              apy: '0.02405727775538844641',
              usageAsCollateralEnabled: false,
              ltv: '0.75',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 43114,
                address: '0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.0002524',
              balance: '214291.813654',
              apy: '0.11245319633282759276',
              usageAsCollateralEnabled: true,
              ltv: '0.825',
              liquidationThreshold: '0.8625',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 43114,
                address: '0x9702230A8Ea53601f5cD2dc00fDBc13d4dF4A8c7',
                decimals: 6,
                symbol: 'USDt',
                name: 'TetherToken',
              },
              price: '0.9998278',
              balance: '0',
              apy: '0.10990662301331500012',
              usageAsCollateralEnabled: true,
              ltv: '0.75',
              liquidationThreshold: '0.81',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 43114,
                address: '0x152b9d0FdC40C096757F570A51E494bd4b943E50',
                decimals: 8,
                symbol: 'BTC.b',
                name: 'Bitcoin',
              },
              price: '42540.80155',
              balance: '44.24454272',
              apy: '0.00018399211774211181',
              usageAsCollateralEnabled: true,
              ltv: '0.7',
              liquidationThreshold: '0.75',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 43114,
                address: '0xd586E7F844cEa2F87f50152665BCbc2C279D8d70',
                decimals: 18,
                symbol: 'DAI.e',
                name: 'Dai Stablecoin',
              },
              price: '1',
              balance: '0',
              apy: '0.04475631358170004319',
              usageAsCollateralEnabled: true,
              ltv: '0.75',
              liquidationThreshold: '0.82',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 43114,
                address: '0x5947BB275c521040051D82396192181b413227A3',
                decimals: 18,
                symbol: 'LINK.e',
                name: 'Chainlink Token',
              },
              price: '14.58823',
              balance: '0',
              apy: '0.00110636904532698615',
              usageAsCollateralEnabled: true,
              ltv: '0.56',
              liquidationThreshold: '0.71',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 43114,
                address: '0x50b7545627a5162F82A992c33b87aDc75187B218',
                decimals: 8,
                symbol: 'WBTC.e',
                name: 'Wrapped BTC',
              },
              price: '42540.80155',
              balance: '0',
              apy: '0.00008002157304503949',
              usageAsCollateralEnabled: true,
              ltv: '0.7',
              liquidationThreshold: '0.75',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 43114,
                address: '0x49D5c2BdFfac6CE2BFdB6640F4F80f226bc10bAB',
                decimals: 18,
                symbol: 'WETH.e',
                name: 'Wrapped Ether',
              },
              price: '2255.12839519',
              balance: '0',
              apy: '0.00230482557632344167',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.825',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 43114,
                address: '0x2b2C81e08f1Af8835a78Bb2A90AE924ACE0eA4bE',
                decimals: 18,
                symbol: 'sAVAX',
                name: 'Staked AVAX',
              },
              price: '50.1216625',
              balance: '0',
              apy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.3',
              liquidationThreshold: '0.4',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 43114,
                address: '0x63a72806098Bd3D9520cC43356dD78afe5D386D9',
                decimals: 18,
                symbol: 'AAVE.e',
                name: 'Aave Token',
              },
              price: '107.31447',
              balance: '0',
              apy: '0',
              usageAsCollateralEnabled: true,
              ltv: '0.6',
              liquidationThreshold: '0.713',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 43114,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'AVAX',
                name: 'Avalanche',
              },
              price: '44.7',
              balance: '0',
              apy: '0.01601086886712040041',
              usageAsCollateralEnabled: true,
              ltv: '0.68',
              liquidationThreshold: '0.73',
              isNotCollateral: false,
            },
          ],
          borrows: [
            {
              token: {
                chainId: 43114,
                address: '0xD24C2Ad096400B6FBcd2ad8B24E7acBc21A1da64',
                decimals: 18,
                symbol: 'FRAX',
                name: 'Frax',
              },
              price: '0.99923705',
              balances: ['0', '0'],
              apys: ['0.0390503021725579184', '0.06591193785036693658'],
            },
            {
              token: {
                chainId: 43114,
                address: '0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E',
                decimals: 6,
                symbol: 'USDC',
                name: 'USD Coin',
              },
              price: '1.0002524',
              balances: ['0', '0'],
              apys: ['0.14104271614818463309', '0.15828736836980377194'],
            },
            {
              token: {
                chainId: 43114,
                address: '0x9702230A8Ea53601f5cD2dc00fDBc13d4dF4A8c7',
                decimals: 6,
                symbol: 'USDt',
                name: 'TetherToken',
              },
              price: '0.9998278',
              balances: ['0', '0'],
              apys: ['0.13984284203255391256', '0.15706936047979261742'],
            },
            {
              token: {
                chainId: 43114,
                address: '0x152b9d0FdC40C096757F570A51E494bd4b943E50',
                decimals: 8,
                symbol: 'BTC.b',
                name: 'Bitcoin',
              },
              price: '42540.80155',
              balances: ['0', '0'],
              apys: ['0.00599897178397704241', '0.09417428356469140047'],
            },
            {
              token: {
                chainId: 43114,
                address: '0xd586E7F844cEa2F87f50152665BCbc2C279D8d70',
                decimals: 18,
                symbol: 'DAI.e',
                name: 'Dai Stablecoin',
              },
              price: '1',
              balances: ['0', '0'],
              apys: ['0.05550240589399468333', '0.07145428192496638585'],
            },
            {
              token: {
                chainId: 43114,
                address: '0x5947BB275c521040051D82396192181b413227A3',
                decimals: 18,
                symbol: 'LINK.e',
                name: 'Chainlink Token',
              },
              price: '14.58823',
              balances: ['0', '0'],
              apys: ['0.0147711962077648869', '0.09417428356469140047'],
            },
            {
              token: {
                chainId: 43114,
                address: '0x50b7545627a5162F82A992c33b87aDc75187B218',
                decimals: 8,
                symbol: 'WBTC.e',
                name: 'Wrapped BTC',
              },
              price: '42540.80155',
              balances: ['0', '0'],
              apys: ['0.00298621616953280854', '0.06183654648475251348'],
            },
            {
              token: {
                chainId: 43114,
                address: '0x49D5c2BdFfac6CE2BFdB6640F4F80f226bc10bAB',
                decimals: 18,
                symbol: 'WETH.e',
                name: 'Wrapped Ether',
              },
              price: '2255.12839519',
              balances: ['503.56783201033014682', '0'],
              apys: ['0.01754778358317233615', '0.07873045056775466992'],
            },
            {
              token: {
                chainId: 43114,
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                symbol: 'AVAX',
                name: 'Avalanche',
              },
              price: '44.7',
              balances: ['0', '0'],
              apys: ['0.04424966051329394784', '0.12805916065938216792'],
            },
          ],
        },
      },
      {
        chainId: common.ChainId.metis,
        account: '0x6859dA14835424957a1E6B397D8026B1D9fF7e1E',
        blockTag: 9723956,
        expected: {
          chainId: 1088,
          protocolId: 'aave-v3',
          marketId: 'metis',
          utilization: '0.90566901899748112035',
          healthRate: '1.17316588920765000099',
          netAPY: '0.01703506792443164733',
          totalSupplyUSD: '651222.83357431977924308968815744',
          totalBorrowUSD: '292970.85411820554313194246800317',
          supplies: [
            {
              token: {
                chainId: 1088,
                address: '0x4c078361FC9BbB78DF910800A991C7c3DD2F6ce0',
                decimals: 18,
                symbol: 'm.DAI',
                name: 'DAI Token',
              },
              price: '1.00002038',
              balance: '0',
              apy: '0.08922117566842144708',
              usageAsCollateralEnabled: true,
              ltv: '0.75',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1088,
                address: '0xEA32A96608495e54156Ae48931A7c20f0dcc1a21',
                decimals: 6,
                symbol: 'm.USDC',
                name: 'USDC Token',
              },
              price: '1.00026504',
              balance: '404249.81361',
              apy: '0.0226843306506274095',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.85',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1088,
                address: '0xbB06DCA3AE6887fAbF931640f67cab3e3a16F4dC',
                decimals: 6,
                symbol: 'm.USDT',
                name: 'USDT Token',
              },
              price: '0.99968',
              balance: '0',
              apy: '0.03256071161295637577',
              usageAsCollateralEnabled: true,
              ltv: '0.75',
              liquidationThreshold: '0.8',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1088,
                address: '0x420000000000000000000000000000000000000A',
                decimals: 18,
                symbol: 'WETH',
                name: 'Ether',
              },
              price: '2247.8',
              balance: '0',
              apy: '0.00592587703680170438',
              usageAsCollateralEnabled: true,
              ltv: '0.8',
              liquidationThreshold: '0.825',
              isNotCollateral: false,
            },
            {
              token: {
                chainId: 1088,
                address: '0xDeadDeAddeAddEAddeadDEaDDEAdDeaDDeAD0000',
                decimals: 18,
                symbol: 'Metis',
                name: 'Metis Token',
              },
              price: '25.26107283',
              balance: '9772.580889776904413568',
              apy: '0.00036678993727261258',
              usageAsCollateralEnabled: false,
              ltv: '0',
              liquidationThreshold: '0',
              isNotCollateral: false,
            },
          ],
          borrows: [
            {
              token: {
                chainId: 1088,
                address: '0x4c078361FC9BbB78DF910800A991C7c3DD2F6ce0',
                decimals: 18,
                symbol: 'm.DAI',
                name: 'DAI Token',
              },
              price: '1.00002038',
              balances: ['0', '0'],
              apys: ['0.12397608039130557217', '0.14096280345328555618'],
            },
            {
              token: {
                chainId: 1088,
                address: '0xEA32A96608495e54156Ae48931A7c20f0dcc1a21',
                decimals: 6,
                symbol: 'm.USDC',
                name: 'USDC Token',
              },
              price: '1.00026504',
              balances: ['1249.319064', '0'],
              apys: ['0.0379114798618386383', '0.06579505386425172688'],
            },
            {
              token: {
                chainId: 1088,
                address: '0xbB06DCA3AE6887fAbF931640f67cab3e3a16F4dC',
                decimals: 6,
                symbol: 'm.USDT',
                name: 'USDT Token',
              },
              price: '0.99968',
              balances: ['0', '0'],
              apys: ['0.04547726467489857161', '0.06656942115415879311'],
            },
            {
              token: {
                chainId: 1088,
                address: '0x420000000000000000000000000000000000000A',
                decimals: 18,
                symbol: 'WETH',
                name: 'Ether',
              },
              price: '2247.8',
              balances: ['19.947502441895519984', '0'],
              apys: ['0.02413266844839324225', '0.08528874624607211218'],
            },
            {
              token: {
                chainId: 1088,
                address: '0xDeadDeAddeAddEAddeadDEaDDEAdDeaDDeAD0000',
                decimals: 18,
                symbol: 'Metis',
                name: 'Metis Token',
              },
              price: '25.26107283',
              balances: ['9773.266939501875097199', '0'],
              apys: ['0.00822587912740514178', '0.10317482893981782391'],
            },
          ],
        },
      },
    ];

    testCases.forEach(({ chainId, account, blockTag, expected }) => {
      it(`${common.toNetworkId(chainId)} market`, async function () {
        const protocol = new LendingProtocol(chainId);
        protocol.setBlockTag(blockTag);
        const portfolio = await protocol.getPortfolio(account);
        expect(JSON.stringify(portfolio)).to.eq(JSON.stringify(expected));
      });
    });
  });
});
